---
import CommentsPanel from "./comments/CommentsPanel.astro";
import AddCommentModal from "./comments/AddCommentModal.astro";
import EditCommentModal from "./comments/EditCommentModal.astro";
import JoinJourneyModal from "./comments/JoinJourneyModal.astro";
import SnapshotLightbox from "./comments/SnapshotLightbox.astro";
---

<section class="w-full">
  <div class="rounded-[28px] bg-slate-900/55 p-5 shadow-[0_18px_50px_rgba(0,0,0,0.4)] ring-1 ring-white/5 sm:p-6">
    <div class="mb-4 flex items-center gap-2" role="tablist" aria-label="Bottom panel views">
      <button
        type="button"
        class="bottomsheet-tab is-active inline-flex items-center justify-center rounded-full px-4 py-2 text-xs font-semibold uppercase tracking-[0.14em] text-slate-200 transition"
        data-bottomsheet-tab="comments"
      >
        Comments
      </button>
      <button
        type="button"
        class="bottomsheet-tab inline-flex items-center justify-center rounded-full px-4 py-2 text-xs font-semibold uppercase tracking-[0.14em] text-slate-200 transition"
        data-bottomsheet-tab="status"
      >
        Data
      </button>
    </div>

    <div data-bottomsheet-panel="status" class="hidden">
      <div class="mb-3 flex items-center justify-between gap-3">
        <div
          id="stale-indicator"
          class="hidden rounded-full bg-amber-500/10 px-3 py-1 text-[10px] font-medium uppercase tracking-wide text-amber-200 ring-1 ring-amber-300/30"
        >
          Data stale
        </div>
      </div>

      <div class="grid gap-3 text-sm text-slate-300 sm:grid-cols-2">
        <div>
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate-500">
            Timestamp
          </div>
          <div id="last-seen-time" class="font-normal">--</div>
        </div>
        <div>
          <div class="text-[11px] uppercase tracking-[0.2em] text-slate-500">
            Coordinates
          </div>
          <div id="coords" class="font-normal">--</div>
        </div>
      </div>

      <div id="last-sighting-pill" class="mt-4">
        <div class="text-[11px] uppercase tracking-[0.2em] text-slate-500">
          Last known sighting
        </div>
        <div class="text-sm text-slate-300">
          <span id="location-label">Loading</span>,
          <span id="age-minutes">--</span> mins ago
        </div>
      </div>

      <div id="reconnect-row" class="mt-5 flex flex-wrap items-center justify-between gap-3">
        <div class="flex items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-slate-500">
          Status
          <span id="status-text-inline" class="text-emerald-300">Online</span>
        </div>
        <button
          id="reconnect-btn"
          class="inline-flex items-center justify-center rounded-full bg-amber-300/10 px-4 py-2 text-xs font-semibold text-amber-200 ring-1 ring-amber-200/30 transition hover:bg-amber-300/20"
          type="button"
        >
          Try again
        </button>
      </div>

      <div id="reconnect-message-wrap" class="mt-3 flex items-center gap-2 text-[11px] text-slate-500">
        <span class="h-2 w-2 animate-spin rounded-full border border-amber-200/60 border-t-transparent"></span>
        <span id="reconnect-message">Reconnecting to stream...</span>
      </div>

      <div class="mt-5 rounded-2xl bg-slate-950/50 p-4 ring-1 ring-white/5">
        <div class="mb-3 text-[11px] uppercase tracking-[0.2em] text-slate-500">
          Telemetry
        </div>
        <div class="grid gap-3 text-sm text-slate-300 sm:grid-cols-2">
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Latitude</div>
            <div id="telemetry-lat">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Longitude</div>
            <div id="telemetry-lon">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Altitude</div>
            <div id="telemetry-alt">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Speed</div>
            <div id="telemetry-speed">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Heading</div>
            <div id="telemetry-heading">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Accuracy</div>
            <div id="telemetry-accuracy">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Trail window</div>
            <div id="telemetry-trail-window">24h</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Trail points</div>
            <div id="telemetry-trail-points">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Distance</div>
            <div id="telemetry-distance">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Weather</div>
            <div id="telemetry-weather">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Feels like</div>
            <div id="telemetry-feels">--</div>
          </div>
          <div>
            <div class="text-[11px] uppercase tracking-[0.16em] text-slate-500">Weather station</div>
            <div id="telemetry-weather-location">--</div>
          </div>
        </div>
        <div class="mt-3 text-xs text-slate-500">
          Last updated <span id="telemetry-updated">--</span>
        </div>
      </div>
    </div>

    <div data-bottomsheet-panel="comments">
      <CommentsPanel />
    </div>
  </div>

  <AddCommentModal />
  <EditCommentModal />
  <JoinJourneyModal />
  <SnapshotLightbox />
</section>
